generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String              @id @default(cuid())
  email        String              @unique
  name         String?
  password     String
  role         Role                @default(USER)
  isActive     Boolean             @default(true)
  avatar       String?
  lastLoginAt  DateTime?
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  balance      Float               @default(0)
  orders       Order[]
  pteroServers PterodactylServer[]
  services     Service[]
  sessions     Session[]
  loginHistory LoginHistory[]
  invoices     Invoice[]
  transactions WalletTransaction[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Service {
  id          String        @id @default(cuid())
  name        String
  type        ServiceType
  status      ServiceStatus @default(PENDING)
  price       Float
  config      Json?
  ip          String?
  port        Int?
  description String?
  userId      String
  expiresAt   DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  orders      Order[]
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Order {
  id            String      @id @default(cuid())
  userId        String
  serviceId     String?
  amount        Float
  status        OrderStatus @default(PENDING)
  paymentMethod String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  service       Service?    @relation(fields: [serviceId], references: [id])
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  invoices      Invoice[]
}

model PterodactylServer {
  id            String   @id @default(cuid())
  pteroId       String   @unique
  identifier    String   @unique
  name          String
  description   String?
  status        String
  suspended     Boolean  @default(false)
  limits        Json
  featureLimits Json
  userId        String?
  nodeId        String
  allocationId  String
  allocationIp  String?
  allocationPort Int?
  allocationAlias String?
  nestId        String
  eggId         String
  container     Json?
  // Resource monitoring fields
  cpuUsage      Float?
  memoryUsage   Int?
  memoryLimit   Int?
  diskUsage     Int?
  diskLimit     Int?
  networkRx     Int?
  networkTx     Int?
  uptime        Int?
  lastSyncAt    DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User?    @relation(fields: [userId], references: [id])
}

model ApiConfiguration {
  id          String   @id @default(cuid())
  name        String   @unique
  apiUrl      String
  apiKey      String
  isActive    Boolean  @default(true)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model LoginHistory {
  id          String   @id @default(cuid())
  userId      String
  loginTime   DateTime @default(now())
  ip          String
  userAgent   String
  location    String?
  device      String?
  browser     String?
  isActive    Boolean  @default(false)
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([loginTime])
}

model StoreItem {
  id          String      @id @default(cuid())
  title       String      @unique
  description String?
  price       Float
  category    StoreCategory
  imageUrl    String?
  imageLink   String?
  isActive    Boolean     @default(true)
  featured    Boolean     @default(false)
  metadata    Json?       // Additional data like download links, specs, etc.
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Invoice {
  id            String         @id @default(cuid())
  invoiceNumber String         @unique
  userId        String
  orderId       String?
  title         String
  description   String?
  amount        Float
  status        InvoiceStatus  @default(PENDING)
  dueDate       DateTime
  paidAt        DateTime?
  paymentMethod String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  order         Order?         @relation(fields: [orderId], references: [id])
}

model WalletTransaction {
  id          String               @id @default(cuid())
  userId      String
  type        TransactionType
  amount      Float
  description String?
  balance     Float               // Balance after transaction
  metadata    Json?               // Additional data like invoiceId, paymentMethod, etc.
  createdAt   DateTime            @default(now())
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  USER
  ADMIN
  OWNER
}

enum ServiceType {
  GAME_HOSTING
  RDP
  FIVEM_DEVELOPMENT
  ROBLOX_DEVELOPMENT
}

enum ServiceStatus {
  PENDING
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum OrderStatus {
  PENDING
  COMPLETED
  CANCELLED
  REFUNDED
}

enum InvoiceStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum TransactionType {
  TOP_UP
  PAYMENT
  REFUND
  BONUS
  PENALTY
}

enum StoreCategory {
  MOD
  GAME
  HOSTING
  SERVER
}